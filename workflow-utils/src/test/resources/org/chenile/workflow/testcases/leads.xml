<?xml version="1.0" encoding="UTF-8"?>

<states>
	<enablement-strategy componentName="configBasedEnablementStrategy"/>
	<event-information eventId='__GENERIC_EVENT__'
					   meta-bodyType='org.chenile.workflow.param.MinimalPayload'/>
	<event-information eventId='scheduleMeeting'
                       meta-bodyType='com.getvymo.lending.lead.dto.LeadMeetingPayload'
    />
	<event-information eventId='allocateAgent'
					   meta-bodyType='com.getvymo.lending.lead.dto.AllocateAgentPayload'
	/>
	<event-information eventId='reallocateAgent'
					   meta-bodyType='com.getvymo.lending.lead.dto.AllocateAgentPayload'
	/>
	<event-information eventId='rescheduleMeeting'
					   meta-bodyType='com.getvymo.lending.lead.dto.LeadMeetingPayload'
	/>
	<event-information eventId='completeMeeting'
					   meta-bodyType='com.getvymo.lending.lead.dto.LeadMeetingPayload'
	/>
	<event-information eventId='cannotContact'
                       meta-bodyType='org.chenile.workflow.param.MinimalPayload'
    />
	<event-information eventId='establishContact'
                       meta-bodyType='org.chenile.workflow.param.MinimalPayload'
    />
	<event-information eventId='doNeedsAssessment'
					   meta-bodyType='org.chenile.workflow.param.MinimalPayload'
	/>
	<event-information eventId='pitchProduct'
					   meta-bodyType='org.chenile.workflow.param.MinimalPayload'
	/>
	<event-information eventId='loseLead'
					   meta-bodyType='org.chenile.workflow.param.MinimalPayload'
	/>
	<event-information eventId='initiateApplication'
					   meta-bodyType='org.chenile.workflow.param.MinimalPayload'
					   componentName="initiateApplicationAction"
	/>
	<default-transition-action componentName="commentAction"/>
	
	<flow id='LEAD_FLOW' default='true'>
		<entry-action componentName="leadEntryAction"/>
		<exit-action componentName="leadExitAction"/>
		<if id='CONTACTED_BEFORE' initialState='true' meta-mainPath="true"
				condition="(allocatedAgent != null) &amp;&amp; contactedBefore"
				then="contacted"
				else="notContacted">
			<on eventId='contacted'  newStateId='CONTACTED' />
			<on eventId="notContacted" newStateId="NEW"/>
		</if>

		<manual-state id='NEW'>
			<on eventId="scheduleMeeting" componentName="leadMeetingAction"/>
			<on eventId="rescheduleMeeting" componentName="leadMeetingAction"/>
			<on eventId='completeMeeting' componentName="leadMeetingAction"  />
			<on eventId='cannotContact' newStateId='NOT_CONTACTABLE' componentName="commentAction" />
			<on eventId='makeFirstContact' newStateId='CONTACTED' />
			<on eventId="allocateAgent" componentName="allocateAgent"/>
		</manual-state>
		<manual-state id='CONTACTED' meta-mainPath="true">
			<on eventId="scheduleMeeting"  componentName="leadMeetingAction"/>
			<on eventId="rescheduleMeeting" componentName="leadMeetingAction"/>
			<on eventId='completeMeeting' componentName="leadMeetingAction"  />
			<on eventId='doNeedsAssessment' newStateId='NEEDS_ASSESSMENT_DONE' componentName="commentAction" />
			<on eventId='pitchProduct' newStateId='PRODUCT_PITCHED' componentName="commentAction" />
			<on eventId='initiateApplication' newStateId='WON' componentName="initiateApplicationAction"/>
			<on eventId='loseLead' newStateId='LOST' componentName="commentAction" />
			<on eventId="reallocateAgent" componentName="allocateAgent"/>
		</manual-state>
		<manual-state id='NEEDS_ASSESSMENT_DONE'  meta-mainPath="true" >
			<on eventId="scheduleMeeting"  componentName="leadMeetingAction"/>
			<on eventId="rescheduleMeeting" componentName="leadMeetingAction"/>
			<on eventId='completeMeeting' componentName="leadMeetingAction"  />
			<on eventId='pitchProduct' newStateId='PRODUCT_PITCHED' componentName="commentAction" />
			<on eventId='initiateApplication' newStateId='WON' componentName="initiateApplicationAction"/>
			<on eventId='loseLead' newStateId='LOST' componentName="commentAction" />
			<on eventId="reallocateAgent" componentName="allocateAgent"/>
		</manual-state>
		<manual-state id='PRODUCT_PITCHED'  meta-mainPath="true">
			<on eventId="scheduleMeeting"  componentName="leadMeetingAction"/>
			<on eventId="rescheduleMeeting" componentName="leadMeetingAction"/>
			<on eventId='completeMeeting' componentName="leadMeetingAction"  />
			<on eventId='initiateApplication' newStateId='WON' componentName="initiateApplicationAction"/>
			<on eventId='loseLead' newStateId='LOST' componentName="commentAction" />
			<on eventId="reallocateAgent" componentName="allocateAgent"/>
		</manual-state>
		<manual-state id='WON'  meta-mainPath="true"/>
		<manual-state id='LOST'/>
		<manual-state id='NOT_CONTACTABLE'>
			<on eventId='establishContact' newStateId='CONTACTED' componentName="commentAction" />
			<on eventId='loseLead' newStateId='LOST' componentName="commentAction" />
			<on eventId="reallocateAgent" componentName="allocateAgent"/>
		</manual-state>
	</flow>
	
</states>
